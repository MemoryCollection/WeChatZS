<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微信任务管理</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            display: grid;
            grid-template-columns: 3fr 1fr;
            grid-gap: 20px;
            padding: 20px;
        }

        .settings {
            display: grid;
            grid-template-rows: auto auto;
            grid-gap: 10px;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .select-list {
            display: flex;
            flex-direction: column;
        }

        .history {
            grid-row: 2 / 4;
        }

        .status {
            display: flex;
            flex-direction: column;
        }

        button {
            padding: 5px 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="settings">
            <div class="settings-row">
                <div>
                    邀请数量：<input type="number" id="invite_count" value="10">
                    群聊分组：<select id="group_class">
                        <option value="option1">选项1</option>
                        <option value="option2">选项2</option>
                    </select>
                    邀请目标：<input type="text" id="invite_target" value="laqun">
                    <button id="invite_button">邀请按钮</button>
                </div>
                <div class="select-list">
                    <select id="user_select" multiple>
                        <!-- 用户选择列表将动态填充 -->
                    </select>
                    <button id="inject_button">注入按钮</button>
                </div>
            </div>
            <div class="settings-row">
                <div>
                    随机秒：<input type="text" id="random_seconds" value="3-5">
                    天数：<input type="number" id="days" value="2">
                    未读消息：<input type="number" id="unread_messages" value="50">
                    群发群组：<select id="group_names" multiple>
                        <option value="旅游">旅游</option>
                        <option value="工商">工商</option>
                        <option value="未分">未分</option>
                    </select>
                    循环时间：<input type="text" id="cycle_time" value="3小时">
                    <button id="send_group_button">开始按钮</button>
                </div>
                <div class="select-list">
                    <select id="user_info_select" multiple>
                        <!-- 用户信息选择列表将动态填充 -->
                    </select>
                </div>
            </div>
        </div>
        <div class="status">
            <h3>服务器状态</h3>
            <p>前后端链接状态: <span id="connection_status">未连接</span></p>
            <p>线程数: <span id="thread_count">0</span></p>
            <p>那个用户在执行什么任务: <span id="task_status">无</span></p>
        </div>
        <div class="history">
            <h3>执行历史</h3>
            <div id="history_info">
                <!-- 执行历史信息将动态填充 -->
            </div>
        </div>
    </div>

    <script>
        const count = {{ count }};
        const userSelect = document.getElementById('user_select');
        userSelect.innerHTML = '';
        for (let i = 0; i < count; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            userSelect.appendChild(option);
        }

        document.getElementById('inject_button').addEventListener('click', function () {
            const selectedOptions = Array.from(userSelect.selectedOptions).map(option => parseInt(option.value));
            fetch('/init_wcf', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nums: selectedOptions })
            })
           .then(response => response.json())
           .then(data => {
                const userInfoSelect = document.getElementById('user_info_select');
                userInfoSelect.innerHTML = '';
                data.forEach(info => {
                    const option = document.createElement('option');
                    option.value = info.index;
                    option.textContent = `${info.name} - ${info.mobile} - ${info.wxid}`;
                    userInfoSelect.appendChild(option);
                });
            });
        });

        document.getElementById('send_group_button').addEventListener('click', function () {
            const randomSeconds = document.getElementById('random_seconds').value;
            const days = document.getElementById('days').value;
            const unreadMessages = document.getElementById('unread_messages').value;
            const groupNames = Array.from(document.getElementById('group_names').selectedOptions).map(option => option.value);
            fetch('/send_group_messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    random_seconds: randomSeconds,
                    days: days,
                    unread_messages: unreadMessages,
                    group_names: groupNames
                })
            })
           .then(response => response.json())
           .then(data => {
                console.log(data);
            });
        });

        document.getElementById('invite_button').addEventListener('click', function () {
            const inviteCount = document.getElementById('invite_count').value;
            const groupClass = document.getElementById('group_class').value;
            const inviteTarget = document.getElementById('invite_target').value;
            fetch('/invite_friends_to_group', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    invite_count: inviteCount,
                    group_class: groupClass,
                    invite_target: inviteTarget
                })
            })
           .then(response => response.json())
           .then(data => {
                console.log(data);
            });
        });
    </script>
</body>

</html>
